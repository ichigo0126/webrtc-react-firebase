{"version":3,"sources":["components/InputFormLocal.js","components/InputFormRemote.js","components/InputForms.js","components/AudioVisualiser.js","components/AudioAnalyser.js","components/VolumeButton.js","components/hooks/useDimentions.js","components/Video.js","components/VideoLocal.js","components/VideoRemote.js","components/VideoArea.js","utils/FirebaseSignallingClient.js","utils/RtcClient.js","components/hooks/useRtcClient.js","components/App.js","index.js"],"names":["Copyright","Typography","variant","color","align","Link","href","Date","getFullYear","useStyles","makeStyles","theme","paper","marginTop","spacing","display","flexDirection","alignItems","avatar","margin","backgroundColor","palette","secondary","main","form","width","submit","SignIn","rtcClient","label","classes","useState","disabled","setDisabled","name","setName","isComposed","setIsComposed","useEffect","initializeLocalPeer","useCallback","e","a","startListening","preventDefault","localPeerName","Container","component","maxWidth","CssBaseline","className","noValidate","TextField","autoFocus","fullWidth","onChange","target","value","onCompositionEnd","onCompositionStart","onKeyDown","key","required","Button","onClick","type","Box","mt","initializeRemotePeer","connect","remotePeerName","InputForms","AudioVisualiser","props","canvas","React","createRef","this","draw","audioData","current","height","context","getContext","x","sliceWidth","length","lineWidth","strokeStyle","clearRect","beginPath","moveTo","y","lineTo","stroke","ref","Component","AudioAnalyser","state","Uint8Array","tick","bind","audioContext","window","AudioContext","webkitAudioContext","analyser","createAnalyser","dataArray","frequencyBinCount","source","createMediaStreamSource","audio","rafId","requestAnimationFrame","getByteTimeDomainData","setState","cancelAnimationFrame","disconnect","icon","VolumeButton","isLocal","muted","refVolumeButton","setMuted","Icon","VolumeOffIcon","VolumeUpIcon","IconButton","aria-label","previousState","toggleAudio","defaultDimensions","useDimensions","targetRef","dimensions","setDimensions","node","updateDimensions","offsetWidth","offsetHeight","resizeDimensions","removeEventListener","addEventListener","Video","videoRef","initialAudioMuted","refCard","useRef","dimensionsCard","dimensionsVolumeButton","console","log","srcObject","Card","CardActionArea","autoPlay","CardContent","gutterBottom","CardActions","VideoLocal","currentVideoRef","mediaStream","err","error","getMedia","VideoRemote","remoteVideoRef","root","flexGrow","padding","textAlign","text","VideoArea","Grid","container","item","xs","sm","FirebaseSignallingClient","process","firebaseConfig","apiKey","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_FIREBASE_AUTH_DOMAIN","databaseURL","REACT_APP_FIREBASE_DATABASE_URL","projectId","REACT_APP_FIREBASE_PROJECT_ID","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","messagingSenderId","REACT_APP_FIREBASE_MESSAGING_SENDER_ID","appId","REACT_APP_FIREBASE_APP_ID","firebase","apps","initializeApp","database","sessionDescription","set","sender","candidate","path","remove","RtcClient","setRtcClient","rtcPeerConnection","RTCPeerConnection","iceServers","urls","firebaseSignallingClient","_setRtcClient","constraints","video","navigator","mediaDevices","getUserMedia","addTracks","addAudioTrack","addVideoTrack","audioTrack","enabled","addTrack","videoTrack","createOffer","setLocalDescription","sendOffer","setPeerNames","localDescription","ontrack","rtcTrackEvent","track","kind","remoteMediaStream","streams","setOnicecandidateCallback","setOntrack","setRemoteDescription","createAnswer","answer","sendAnswer","offer","iceCandidate","RTCIceCandidate","addIceCandidate","onicecandidate","sendCandidate","toJSON","on","snapshot","data","val","saveReceivedSessionDescription","getAudioTracks","getVideoTracks","useRtcClient","useReducer","boolean","forceRender","client","setMediaStream","init","App","ReactDOM","render","document","getElementById"],"mappings":"iRAUA,SAASA,IACP,OACE,eAACC,EAAA,EAAD,CAAYC,QAAQ,QAAQC,MAAM,gBAAgBC,MAAM,SAAxD,UACG,kBACD,cAACC,EAAA,EAAD,CAAMF,MAAM,UAAUG,KAAK,sCAA3B,sCAEQ,KACP,IAAIC,MAAOC,cACX,OAKP,IAAMC,EAAYC,aAAW,SAACC,GAAD,MAAY,CACvCC,MAAO,CACLC,UAAWF,EAAMG,QAAQ,GACzBC,QAAS,OACTC,cAAe,SACfC,WAAY,UAEdC,OAAQ,CACNC,OAAQR,EAAMG,QAAQ,GACtBM,gBAAiBT,EAAMU,QAAQC,UAAUC,MAE3CC,KAAM,CACJC,MAAO,OACPZ,UAAWF,EAAMG,QAAQ,IAE3BY,OAAQ,CACNP,OAAQR,EAAMG,QAAQ,EAAG,EAAG,QAIjB,SAASa,EAAT,GAAgC,IAAdC,EAAa,EAAbA,UACzBC,EAAQ,uCACRC,EAAUrB,IAF4B,EAGZsB,oBAAS,GAHG,mBAGrCC,EAHqC,KAG3BC,EAH2B,OAIpBF,mBAAS,IAJW,mBAIrCG,EAJqC,KAI/BC,EAJ+B,OAKRJ,oBAAS,GALD,mBAKrCK,EALqC,KAKzBC,EALyB,KAO5CC,qBAAU,WAERL,EAD0B,KAATC,KAEhB,CAACA,IAEJ,IAAMK,EAAsBC,sBAAW,uCACrC,WAAOC,GAAP,SAAAC,EAAA,sEACQd,EAAUe,eAAeT,GADjC,OAEEO,EAAEG,iBAFJ,2CADqC,sDAKrC,CAACV,EAAMN,IAGT,MAAgC,KAA5BA,EAAUiB,cAA6B,6BAGzC,eAACC,EAAA,EAAD,CAAWC,UAAU,OAAOC,SAAS,KAArC,UACE,cAACC,EAAA,EAAD,IACA,sBAAKC,UAAWpB,EAAQlB,MAAxB,UACE,eAACX,EAAA,EAAD,CAAY8C,UAAU,KAAK7C,QAAQ,KAAnC,UACG2B,EADH,4DAGA,uBAAMqB,UAAWpB,EAAQN,KAAM2B,YAAU,EAAzC,UACE,cAACC,EAAA,EAAD,CACEC,WAAS,EACTC,WAAS,EACTzB,MAAOA,EACPV,OAAO,SACPe,KAAK,OACLqB,SAAU,SAACd,GAAD,OAAON,EAAQM,EAAEe,OAAOC,QAClCC,iBAAkB,kBAAMrB,GAAc,IACtCsB,mBAAoB,kBAAMtB,GAAc,IACxCuB,UAAS,uCAAE,WAAOnB,GAAP,SAAAC,EAAA,0DACLN,EADK,oDAEc,KAAnBK,EAAEe,OAAOC,MAFJ,oDAGK,UAAVhB,EAAEoB,IAHG,gCAGoBtB,EAAoBE,GAHxC,2CAAF,sDAKTqB,UAAQ,EACRL,MAAOvB,EACPhC,QAAQ,aAEV,cAAC6D,EAAA,EAAD,CACEb,UAAWpB,EAAQJ,OACnBvB,MAAM,UACN6B,SAAUA,EACVsB,WAAS,EACTU,QAAO,uCAAE,WAAOvB,GAAP,SAAAC,EAAA,sEAAmBH,EAAoBE,GAAvC,mFAAF,sDACPwB,KAAK,SACL/D,QAAQ,YAPV,gCAaJ,cAACgE,EAAA,EAAD,CAAKC,GAAI,EAAT,SACE,cAACnE,EAAD,SC/FR,SAASA,IACP,OACE,eAACC,EAAA,EAAD,CAAYC,QAAQ,QAAQC,MAAM,gBAAgBC,MAAM,SAAxD,UACG,kBACD,cAACC,EAAA,EAAD,CAAMF,MAAM,UAAUG,KAAK,sCAA3B,sCAEQ,KACP,IAAIC,MAAOC,cACX,OAKP,IAAMC,EAAYC,aAAW,SAACC,GAAD,MAAY,CACvCC,MAAO,CACLC,UAAWF,EAAMG,QAAQ,GACzBC,QAAS,OACTC,cAAe,SACfC,WAAY,UAEdC,OAAQ,CACNC,OAAQR,EAAMG,QAAQ,GACtBM,gBAAiBT,EAAMU,QAAQC,UAAUC,MAE3CC,KAAM,CACJC,MAAO,OACPZ,UAAWF,EAAMG,QAAQ,IAE3BY,OAAQ,CACNP,OAAQR,EAAMG,QAAQ,EAAG,EAAG,QAIjB,SAASa,EAAT,GAAgC,IAAdC,EAAa,EAAbA,UACzBC,EAAQ,iCACRC,EAAUrB,IAF4B,EAGZsB,oBAAS,GAHG,mBAGrCC,EAHqC,KAG3BC,EAH2B,OAIpBF,mBAAS,IAJW,mBAIrCG,EAJqC,KAI/BC,EAJ+B,OAKRJ,oBAAS,GALD,mBAKrCK,EALqC,KAKzBC,EALyB,KAO5CC,qBAAU,WAERL,EAD0B,KAATC,KAEhB,CAACA,IAEJ,IAAMkC,EAAuB5B,sBAAW,uCACtC,WAAOC,GAAP,SAAAC,EAAA,sEACQd,EAAUyC,QAAQnC,GAD1B,OAEEO,EAAEG,iBAFJ,2CADsC,sDAKtC,CAACV,EAAMN,IAGT,MAAgC,KAA5BA,EAAUiB,eACmB,KAA7BjB,EAAU0C,eAD6B,6BAIzC,eAACxB,EAAA,EAAD,CAAWC,UAAU,OAAOC,SAAS,KAArC,UACE,cAACC,EAAA,EAAD,IACA,sBAAKC,UAAWpB,EAAQlB,MAAxB,UACE,eAACX,EAAA,EAAD,CAAY8C,UAAU,KAAK7C,QAAQ,KAAnC,UACG2B,EADH,4DAGA,uBAAMqB,UAAWpB,EAAQN,KAAM2B,YAAU,EAAzC,UACE,cAACC,EAAA,EAAD,CACEC,WAAS,EACTC,WAAS,EACTzB,MAAOA,EACPV,OAAO,SACPe,KAAK,OACLqB,SAAU,SAACd,GAAD,OAAON,EAAQM,EAAEe,OAAOC,QAClCC,iBAAkB,kBAAMrB,GAAc,IACtCsB,mBAAoB,kBAAMtB,GAAc,IACxCuB,UAAS,uCAAE,WAAOnB,GAAP,SAAAC,EAAA,0DACLN,EADK,oDAEc,KAAnBK,EAAEe,OAAOC,MAFJ,oDAGK,UAAVhB,EAAEoB,IAHG,gCAGoBO,EAAqB3B,GAHzC,2CAAF,sDAKTqB,UAAQ,EACRL,MAAOvB,EACPhC,QAAQ,aAEV,cAAC6D,EAAA,EAAD,CACEb,UAAWpB,EAAQJ,OACnBvB,MAAM,UACN6B,SAAUA,EACVsB,WAAS,EACTU,QAAO,uCAAE,WAAOvB,GAAP,SAAAC,EAAA,sEAAmB0B,EAAqB3B,GAAxC,mFAAF,sDACPwB,KAAK,SACL/D,QAAQ,YAPV,gCAaJ,cAACgE,EAAA,EAAD,CAAKC,GAAI,EAAT,SACE,cAAC,EAAD,SCpGR,IAWeI,EAXI,SAAC,GAAmB,IAAjB3C,EAAgB,EAAhBA,UACpB,OAAkB,OAAdA,EAA2B,6BAG7B,qCACE,cAAC,EAAD,CAAgBA,UAAWA,IAC3B,cAAC,EAAD,CAAiBA,UAAWA,Q,6FC6BnB4C,E,kDAtCb,WAAYC,GAAQ,IAAD,8BACjB,cAAMA,IACDC,OAASC,IAAMC,YAFH,E,iEAMjBC,KAAKC,S,6BAGC,IACEC,EAAcF,KAAKJ,MAAnBM,UACFL,EAASG,KAAKH,OAAOM,QACrBC,EAASP,EAAOO,OAChBxD,EAAQiD,EAAOjD,MACfyD,EAAUR,EAAOS,WAAW,MAC9BC,EAAI,EACFC,EAAsB,EAAR5D,EAAesD,EAAUO,OAE7CJ,EAAQK,UAAY,EACpBL,EAAQM,YAAc,UACtBN,EAAQO,UAAU,EAAG,EAAGhE,EAAOwD,GAE/BC,EAAQQ,YACRR,EAAQS,OAAO,EAAGV,EAAS,GAdtB,oBAecF,GAfd,IAeL,2BAA8B,CAAC,IACvBa,EADsB,QACV,IAASX,EAC3BC,EAAQW,OAAOT,EAAGQ,GAClBR,GAAKC,GAlBF,8BAoBLH,EAAQW,OAAOT,EAAGH,EAAS,GAC3BC,EAAQY,W,+BAIR,OAAO,wBAAQrE,MAAOoD,KAAKJ,MAAMhD,MAAOwD,OAAO,KAAKc,IAAKlB,KAAKH,a,GAnCpCsB,aCqCfC,E,kDAnCb,WAAYxB,GAAQ,IAAD,8BACjB,cAAMA,IACDyB,MAAQ,CAAEnB,UAAW,IAAIoB,WAAW,IACzC,EAAKC,KAAO,EAAKA,KAAKC,KAAV,gBAHK,E,gEAOjBxB,KAAKyB,aAAe,IAAKC,OAAOC,cAC9BD,OAAOE,oBACT5B,KAAK6B,SAAW7B,KAAKyB,aAAaK,iBAClC9B,KAAK+B,UAAY,IAAIT,WAAWtB,KAAK6B,SAASG,mBAC9ChC,KAAKiC,OAASjC,KAAKyB,aAAaS,wBAAwBlC,KAAKJ,MAAMuC,OACnEnC,KAAKiC,OAAOzC,QAAQQ,KAAK6B,UACzB7B,KAAKoC,MAAQC,sBAAsBrC,KAAKuB,Q,6BAIxCvB,KAAK6B,SAASS,sBAAsBtC,KAAK+B,WACzC/B,KAAKuC,SAAS,CAAErC,UAAWF,KAAK+B,YAChC/B,KAAKoC,MAAQC,sBAAsBrC,KAAKuB,Q,6CAIxCiB,qBAAqBxC,KAAKoC,OAC1BpC,KAAK6B,SAASY,aACdzC,KAAKiC,OAAOQ,e,+BAIZ,OAAO,cAAC,EAAD,CAAiBvC,UAAWF,KAAKqB,MAAMnB,UAC9CtD,MAAOoD,KAAKJ,MAAMhD,Y,GA/BMuE,a,2CCGtBvF,EAAYC,YAAW,CACzB6G,KAAM,CACFtC,OAAO,GACPxD,MAAO,MAoBA+F,EAhBM,SAAC,GAA2D,IAA1DC,EAAyD,EAAzDA,QAASC,EAAgD,EAAhDA,MAAOC,EAAyC,EAAzCA,gBAAgB/F,EAAyB,EAAzBA,UAAUgG,EAAe,EAAfA,SACvDC,EAAOH,EAAQI,IAAgBC,IAC/BjG,EAAUrB,IAEhB,OACI,cAACuH,EAAA,EAAD,CAAYC,aAAW,cAAcjE,QAAS,WAC1C4D,GAAS,SAACM,GAAD,OAAoBA,KAC1BT,GAAS7F,EAAUuG,eAE1BpC,IAAK4B,EAJL,SAME,cAACE,EAAD,CAAM3E,UAAWpB,EAAQyF,UCtB7Ba,EAAoB,CAAC3G,MAAO,EAAGwD,OAAQ,GA6B9BoD,EA3BO,SAACC,GAAe,IAAD,EACDvG,mBAAS,CAACN,MAAO,EAAGwD,OAAQ,IAD3B,mBAC5BsD,EAD4B,KAChBC,EADgB,KAE3BC,EAAOH,EAAUtD,QAEjB0D,EAAoB,SAACD,GAGzB,OAAgB,OAATA,EACLL,EACA,CACA3G,MAAOgH,EAAKE,YACZ1D,OAAQwD,EAAKG,eAajB,OAVCL,EAAaG,EAAiBD,GAG9BnG,qBAAU,WACN,IAAMuG,EAAmB,WACrBL,EAAcE,EAAiBD,KAEnClC,OAAOuC,oBAAoB,SAAUD,GACrCtC,OAAOwC,iBAAiB,GAAIF,KAC7B,CAACJ,IACEF,GCyBIS,EAvCD,SAAC,GAA4C,IAA1CvB,EAAyC,EAAzCA,QAASvF,EAAgC,EAAhCA,KAAMN,EAA0B,EAA1BA,UAAWqH,EAAe,EAAfA,SAAe,EAC9BlH,mBAASH,EAAUsH,mBADW,mBACjDxB,EADiD,KAC1CE,EAD0C,KAElDuB,EAAUC,iBAAO,MACjBC,EAAiBhB,EAAcc,GAC/BxB,EAAkByB,iBAAO,MACzBE,EAAyBjB,EAAcV,GAI7C,OAFGsB,EAASjE,SACZuE,QAAQC,IAAI,CAAC/B,UAASgC,UAAWR,EAASjE,QAAQyE,YAEhD,eAACC,EAAA,EAAD,CAAM3D,IAAKoD,EAAX,UACE,eAACQ,EAAA,EAAD,WACA,uBAAOC,UAAQ,EAAClC,MAAOD,GAAWC,EAAO3B,IAAKkD,EAAUxH,MAAO4H,EAAe5H,QAE5E,cAACoI,EAAA,EAAD,UACE,cAAC5J,EAAA,EAAD,CAAY6J,cAAY,EAAC5J,QAAQ,KAAK6C,UAAU,KAAhD,SACGb,SAIP,eAAC6H,EAAA,EAAD,WACE,cAAC,EAAD,CACAtC,QAASA,EACTC,MAAOA,EACPC,gBAAiBA,EACjB/F,UAAWA,EACXgG,SAAUA,KAERF,GAASuB,EAASjE,SAAWiE,EAASjE,QAAQyE,WAChD,cAAC,EAAD,CACAzC,MAAOiC,EAASjE,QAAQyE,UACxBhI,MAAO4H,EAAe5H,MAAQ6H,EAAuB7H,MAAO,YCZrDuI,EA7BI,SAAC,GAAmB,IAAjBpI,EAAgB,EAAhBA,UACdqH,EAAWG,iBAAO,MAClBa,EAAkBhB,EAASjE,QAC3BkF,EAActI,EAAUsI,YAkBhC,OAhBE5H,qBAAU,WACR,GAAwB,OAApB2H,EAAJ,EAEiB,WACf,IACEA,EAAgBR,UAAYS,EAC5B,MAAOC,GACPZ,QAAQa,MAAMD,IAIlBE,MACC,CAACJ,EAAiBC,IAEvBX,QAAQC,IAAI,CAAC5H,cAEkB,KAA5BA,EAAUiB,eAAqD,KAA7BjB,EAAU0C,eACzC,6BAGF,cAAC,EAAD,CAAOmD,SAAS,EAAMvF,KAAMN,EAAUiB,cAAejB,UAAWA,EAAWqH,SAAUA,KCR1EqB,EAhBK,SAAC,GAAmB,IAAjB1I,EAAgB,EAAhBA,UAEfqH,EAAWrH,EAAU2I,eAE3B,MAAgC,KAA7B3I,EAAU0C,eAA6B,6BAGxC,cAAC,EAAD,CACEmD,SAAS,EACTvF,KAAMN,EAAU0C,eAChB1C,UAAWA,EACXqH,SAAUA,KCRVxI,EAAYC,aAAW,SAACC,GAAD,MAAY,CACvC6J,KAAM,CACJC,SAAU,GAEZ7J,MAAO,CACL8J,QAAS/J,EAAMG,QAAQ,GACvB6J,UAAW,SACXxK,MAAOQ,EAAMU,QAAQuJ,KAAKtJ,eAuBfuJ,EAnBG,SAAC,GAAmB,IAAjBjJ,EAAgB,EAAhBA,UACbE,EAAUrB,IAEhB,OAAkB,OAAdmB,EAA2B,6BAG7B,qBAAKsB,UAAWpB,EAAQ0I,KAAxB,SACE,eAACM,EAAA,EAAD,CAAMC,WAAS,EAACjK,QAAS,EAAzB,UACE,cAACgK,EAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIC,GAAI,EAAvB,SACE,cAAC,EAAD,CAAYtJ,UAAWA,MAEzB,cAACkJ,EAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIC,GAAI,EAAvB,SACE,cAAC,EAAD,CAAatJ,UAAWA,Y,SC5BbuJ,I,kBACnB,aAAe,0BAUTC,2nBAEEC,EAAiB,CACrBC,OAbU,EAGVC,2BAWAC,WAdU,EAIVC,+BAWAC,YAfU,EAKVC,gCAWAC,UAhBU,EAMVC,8BAWAC,cAjBU,EAOVC,kCAWAC,kBAlBU,EAQVC,uCAWAC,MAnBU,EASVC,2BAa2B,IAAzBC,KAASC,KAAK/G,QAAc8G,KAASE,cAAcjB,GACvDxG,KAAK0H,SAAWH,KAASG,WACzB1H,KAAKhC,cAAgB,GACrBgC,KAAKP,eAAiB,G,yDAGXzB,EAAeyB,GAC1BO,KAAKhC,cAAgBA,EACrBgC,KAAKP,eAAiBA,I,yEAORkI,G,iFACR3H,KAAKyD,UAAUmE,IAAI,CACvBxI,KAAM,QACNyI,OAAQ7H,KAAKhC,cACb2J,uB,iLAIaA,G,iFACT3H,KAAKyD,UAAUmE,IAAI,CACvBxI,KAAM,SACNyI,OAAQ7H,KAAKhC,cACb2J,uB,oLAIgBG,G,iFACZ9H,KAAKyD,UAAUmE,IAAI,CACvBxI,KAAM,YACNyI,OAAQ7H,KAAKhC,cACb8J,c,6KAISC,G,iFACL/H,KAAK0H,SAASxG,IAAI6G,GAAMC,S,uIA5B9B,OAAOhI,KAAK0H,SAASxG,IAAIlB,KAAKP,oB,MClCbwI,G,WACnB,WAAYvC,EAAgBwC,GAAe,oBAIzClI,KAAKmI,kBAAoB,IAAIC,kBAHd,CACbC,WAAY,CAAC,CAAEC,KAAM,iCAGvBtI,KAAKuI,yBAA2B,IAAIjC,GACpCtG,KAAKhC,cAAgB,GACrBgC,KAAKP,eAAiB,GACtBO,KAAK0F,eAAiBA,EACtB1F,KAAKwI,cAAgBN,EACrBlI,KAAKqF,YAAc,K,2DAQnBrF,KAAKwI,cAAcxI,Q,qKAKXyI,EAAc,CAAEtG,OAAO,EAAMuG,OAAO,G,SACjBC,UAAUC,aAAaC,aAAaJ,G,OAA7DzI,KAAKqF,Y,uDAELX,QAAQa,MAAR,M,gRAKIvF,KAAK6I,e,OACX7I,KAAK8I,YACL9I,KAAKkI,e,wIAILlI,KAAK+I,gBACL/I,KAAKgJ,kB,sCAILhJ,KAAKiJ,WAAWC,QA7CU,MA8C1BlJ,KAAKmI,kBAAkBgB,SAASnJ,KAAKiJ,WAAYjJ,KAAKqF,e,sCAItDrF,KAAKmI,kBAAkBgB,SAASnJ,KAAKoJ,WAAYpJ,KAAKqF,e,oCAYtDrF,KAAKiJ,WAAWC,SAAWlJ,KAAKiJ,WAAWC,QAC3ClJ,KAAKkI,iB,8JAI4BlI,KAAKqJ,c,cAAhC1B,E,gBACA3H,KAAKsJ,oBAAoB3B,G,uBACzB3H,KAAKuJ,Y,6QAKIvJ,KAAKmI,kBAAkBkB,c,wEAEpC3E,QAAQa,MAAR,M,iMAIsBoC,G,0FAEhB3H,KAAKmI,kBAAkBmB,oBAAoB3B,G,sDAEjDjD,QAAQa,MAAR,M,kQAKFvF,KAAKuI,yBAAyBiB,aAC5BxJ,KAAKhC,cACLgC,KAAKP,gB,SAGDO,KAAKuI,yBAAyBgB,UAAUvJ,KAAKyJ,kB,yIAGvC,IAAD,OACXzJ,KAAKmI,kBAAkBuB,QAAU,SAACC,GAChC,GAAiC,UAA7BA,EAAcC,MAAMC,KAAxB,CAEA,IAAMC,EAAoBH,EAAcI,QAAQ,GAChD,EAAKrE,eAAevF,QAAQyE,UAAYkF,EACxC,EAAK5B,iBAGPlI,KAAKkI,iB,sEAGML,EAAQF,G,uFAEjB3H,KAAKP,eAAiBoI,EACtB7H,KAAKgK,4BACLhK,KAAKiK,a,SACCjK,KAAKkK,qBAAqBvC,G,uBACX3H,KAAKmI,kBAAkBgC,e,cAAtCC,E,iBACApK,KAAKmI,kBAAkBmB,oBAAoBc,G,yBAC3CpK,KAAKqK,a,0DAEX3F,QAAQa,MAAR,M,0LAIU9F,G,wEACZO,KAAKP,eAAiBA,EACtBO,KAAKgK,4BACLhK,KAAKiK,a,SACCjK,KAAKsK,Q,OACXtK,KAAKkI,e,2LAGoBP,G,iFACnB3H,KAAKmI,kBAAkB+B,qBAAqBvC,G,2PAIlD3H,KAAKuI,yBAAyBiB,aAC5BxJ,KAAKhC,cACLgC,KAAKP,gB,SAGDO,KAAKuI,yBAAyB8B,WAAWrK,KAAKyJ,kB,oMAGjB9B,G,0FAE3B3H,KAAKkK,qBAAqBvC,G,sDAEhCjD,QAAQa,MAAR,M,8LAQkBuC,G,uFAEZyC,EAAe,IAAIC,gBAAgB1C,G,SACnC9H,KAAKmI,kBAAkBsC,gBAAgBF,G,sDAE7C7F,QAAQa,MAAR,M,iKAIyB,IAAD,OAC1BvF,KAAKmI,kBAAkBuC,eAAvB,uCAAwC,6BAAA7M,EAAA,2DAASiK,EAAT,EAASA,WAAT,gCAE9B,EAAKS,yBAAyBoC,cAAc7C,EAAU8C,UAFxB,2CAAxC,kCAAA5K,KAAA,iB,8EAOmBhC,G,mFACnBgC,KAAKhC,cAAgBA,EACrBgC,KAAKkI,e,SACClI,KAAKuI,yBAAyBP,OAAOhK,G,OAC3CgC,KAAKuI,yBAAyBb,SAC3BxG,IAAIlD,GACJ6M,GAAG,QAFN,uCAEe,WAAOC,GAAP,uBAAAjN,EAAA,yDAEE,QADPkN,EAAOD,EAASE,OADX,iDAIHlD,EAAgDiD,EAAhDjD,UAAWD,EAAqCkD,EAArClD,OAAQF,EAA6BoD,EAA7BpD,mBAAoBvI,EAAS2L,EAAT3L,KAJpC,KAKHA,EALG,OAMJ,UANI,OASJ,WATI,QAYJ,cAZI,wCAOD,EAAKgL,OAAOvC,EAAQF,GAPnB,4DAUD,EAAKsD,+BAA+BtD,GAVnC,6DAaD,EAAK8C,gBAAgB3C,GAbpB,mDAgBP,EAAKI,eAhBE,iEAFf,kCAAAlI,KAAA,gB,+IAhKA,OAAO,I,iCAqCP,OAAOA,KAAKqF,YAAY6F,iBAAiB,K,iCAIzC,OAAOlL,KAAKqF,YAAY8F,iBAAiB,K,uCA+FzC,OAAOnL,KAAKmI,kBAAkBsB,iBAAiBmB,a,KChIpCQ,GAtBM,WAAO,IAAD,EACUlO,mBAAS,MADnB,mBAClBH,EADkB,KACPyL,EADO,KAEnB9C,EAAiBnB,iBAAO,MAFL,EAGD8G,sBAAW,SAACC,GAAD,OAAcA,KAAS,GAAjDC,EAHgB,oBAKnBrD,EAAe,SAACnL,GACpByL,EAAczL,GACdwO,KAYF,OATA9N,qBAAU,YACE,uCAAG,4BAAAI,EAAA,6DACL2N,EAAS,IAAIvD,GAAUvC,EAAgBwC,GADlC,SAELsD,EAAOC,iBAFF,2CAAH,qDAKVC,KACC,IAEI3O,GCPM4O,GAXH,WACV,IAAM5O,EAAYqO,KAElB,OACE,qCACE,cAAC,EAAD,CAAYrO,UAAWA,IACvB,cAAC,EAAD,CAAWA,UAAWA,QCP5B6O,IAASC,OAAO,cAAC,GAAD,IAASC,SAASC,eAAe,U","file":"static/js/main.575a660b.chunk.js","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport TextField from '@material-ui/core/TextField';\nimport Link from '@material-ui/core/Link';\nimport Box from '@material-ui/core/Box';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Container from '@material-ui/core/Container';\n\nfunction Copyright() {\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\n      {'Copyright © '}\n      <Link color=\"inherit\" href=\"https://www.udemy.com/user/ham-san/\">\n        はむさん\n      </Link>{' '}\n      {new Date().getFullYear()}\n      {'.'}\n    </Typography>\n  );\n}\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    marginTop: theme.spacing(8),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main,\n  },\n  form: {\n    width: '100%', // Fix IE 11 issue.\n    marginTop: theme.spacing(1),\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2),\n  },\n}));\n\nexport default function SignIn({ rtcClient }) {\n  const label = 'あなたの名前';\n  const classes = useStyles();\n  const [disabled, setDisabled] = useState(true);\n  const [name, setName] = useState('');\n  const [isComposed, setIsComposed] = useState(false);\n\n  useEffect(() => {\n    const disabled = name === '';\n    setDisabled(disabled);\n  }, [name]);\n\n  const initializeLocalPeer = useCallback(\n    async (e) => {\n      await rtcClient.startListening(name);\n      e.preventDefault();\n    },\n    [name, rtcClient]\n  );\n\n  if (rtcClient.localPeerName !== '') return <></>;\n\n  return (\n    <Container component=\"main\" maxWidth=\"xs\">\n      <CssBaseline />\n      <div className={classes.paper}>\n        <Typography component=\"h1\" variant=\"h5\">\n          {label}を入力してください\n        </Typography>\n        <form className={classes.form} noValidate>\n          <TextField\n            autoFocus\n            fullWidth\n            label={label}\n            margin=\"normal\"\n            name=\"name\"\n            onChange={(e) => setName(e.target.value)}\n            onCompositionEnd={() => setIsComposed(false)}\n            onCompositionStart={() => setIsComposed(true)}\n            onKeyDown={async (e) => {\n              if (isComposed) return;\n              if (e.target.value === '') return;\n              if (e.key === 'Enter') await initializeLocalPeer(e);\n            }}\n            required\n            value={name}\n            variant=\"outlined\"\n          />\n          <Button\n            className={classes.submit}\n            color=\"primary\"\n            disabled={disabled}\n            fullWidth\n            onClick={async (e) => await initializeLocalPeer(e)}\n            type=\"submit\"\n            variant=\"contained\"\n          >\n            決定\n          </Button>\n        </form>\n      </div>\n      <Box mt={8}>\n        <Copyright />\n      </Box>\n    </Container>\n  );\n}","import React, { useCallback, useEffect, useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport TextField from '@material-ui/core/TextField';\nimport Link from '@material-ui/core/Link';\nimport Box from '@material-ui/core/Box';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Container from '@material-ui/core/Container';\n\nfunction Copyright() {\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\n      {'Copyright © '}\n      <Link color=\"inherit\" href=\"https://www.udemy.com/user/ham-san/\">\n        はむさん\n      </Link>{' '}\n      {new Date().getFullYear()}\n      {'.'}\n    </Typography>\n  );\n}\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    marginTop: theme.spacing(8),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main,\n  },\n  form: {\n    width: '100%', // Fix IE 11 issue.\n    marginTop: theme.spacing(1),\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2),\n  },\n}));\n\nexport default function SignIn({ rtcClient }) {\n  const label = '相手の名前';\n  const classes = useStyles();\n  const [disabled, setDisabled] = useState(true);\n  const [name, setName] = useState('');\n  const [isComposed, setIsComposed] = useState(false);\n\n  useEffect(() => {\n    const disabled = name === '';\n    setDisabled(disabled);\n  }, [name]);\n\n  const initializeRemotePeer = useCallback(\n    async (e) => {\n      await rtcClient.connect(name);\n      e.preventDefault();\n    },\n    [name, rtcClient]\n  );\n\n  if (rtcClient.localPeerName === '') return <></>;\n  if (rtcClient.remotePeerName !== '') return <></>;\n\n  return (\n    <Container component=\"main\" maxWidth=\"xs\">\n      <CssBaseline />\n      <div className={classes.paper}>\n        <Typography component=\"h1\" variant=\"h5\">\n          {label}を入力してください\n        </Typography>\n        <form className={classes.form} noValidate>\n          <TextField\n            autoFocus\n            fullWidth\n            label={label}\n            margin=\"normal\"\n            name=\"name\"\n            onChange={(e) => setName(e.target.value)}\n            onCompositionEnd={() => setIsComposed(false)}\n            onCompositionStart={() => setIsComposed(true)}\n            onKeyDown={async (e) => {\n              if (isComposed) return;\n              if (e.target.value === '') return;\n              if (e.key === 'Enter') await initializeRemotePeer(e);\n            }}\n            required\n            value={name}\n            variant=\"outlined\"\n          />\n          <Button\n            className={classes.submit}\n            color=\"primary\"\n            disabled={disabled}\n            fullWidth\n            onClick={async (e) => await initializeRemotePeer(e)}\n            type=\"submit\"\n            variant=\"contained\"\n          >\n            決定\n          </Button>\n        </form>\n      </div>\n      <Box mt={8}>\n        <Copyright />\n      </Box>\n    </Container>\n  );\n}","\nimport React from 'react';\n\nimport InputFormLocal from './InputFormLocal';\nimport InputFormRemote from './InputFormRemote';\n\nconst InputForms = ({ rtcClient }) => {\n  if (rtcClient === null) return <></>;\n\n  return (\n    <>\n      <InputFormLocal rtcClient={rtcClient} />\n      <InputFormRemote rtcClient={rtcClient} />\n    </>\n  );\n};\n\nexport default InputForms;","import React, { Component } from 'react';\n\nclass AudioVisualiser extends Component {\n  constructor(props) {\n    super(props);\n    this.canvas = React.createRef();\n  }\n\n  componentDidUpdate() {\n    this.draw();\n  }\n\n  draw() {\n    const { audioData } = this.props;\n    const canvas = this.canvas.current;\n    const height = canvas.height;\n    const width = canvas.width;\n    const context = canvas.getContext('2d');\n    let x = 0;\n    const sliceWidth = (width * 1.0) / audioData.length;\n\n    context.lineWidth = 2;\n    context.strokeStyle = '#000000';\n    context.clearRect(0, 0, width, height);\n\n    context.beginPath();\n    context.moveTo(0, height / 2);\n    for (const item of audioData) {\n      const y = (item / 255.0) * height;\n      context.lineTo(x, y);\n      x += sliceWidth;\n    }\n    context.lineTo(x, height / 2);\n    context.stroke();\n  }\n\n  render() {\n    return <canvas width={this.props.width} height=\"60\" ref={this.canvas} />;\n  }\n}\n\nexport default AudioVisualiser;\n","import React, { Component } from 'react';\nimport AudioVisualiser from './AudioVisualiser';\n\nclass AudioAnalyser extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { audioData: new Uint8Array(0) };\n    this.tick = this.tick.bind(this);\n  }\n\n  componentDidMount() {\n    this.audioContext = new (window.AudioContext ||\n      window.webkitAudioContext)();\n    this.analyser = this.audioContext.createAnalyser();\n    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    this.source = this.audioContext.createMediaStreamSource(this.props.audio);\n    this.source.connect(this.analyser);\n    this.rafId = requestAnimationFrame(this.tick);\n  }\n\n  tick() {\n    this.analyser.getByteTimeDomainData(this.dataArray);\n    this.setState({ audioData: this.dataArray });\n    this.rafId = requestAnimationFrame(this.tick);\n  }\n\n  componentWillUnmount() {\n    cancelAnimationFrame(this.rafId);\n    this.analyser.disconnect();\n    this.source.disconnect();\n  }\n\n  render() {\n    return <AudioVisualiser audioData={this.state.audioData} \n    width={this.props.width}\n    />;\n  }\n}\n\nexport default AudioAnalyser;\n","import React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton'\nimport VolumeOffIcon from '@material-ui/icons/VolumeOff';\nimport VolumeUpIcon from '@material-ui/icons/VolumeUp';\n\nconst useStyles = makeStyles({\n    icon: {\n        height:38,\n        width: 38,\n    }\n})\n\nconst VolumeButton = ({isLocal, muted, refVolumeButton,rtcClient,setMuted,}) => {\n    const Icon = muted ? VolumeOffIcon : VolumeUpIcon;\n    const classes = useStyles();\n\n    return (\n        <IconButton aria-label=\"switch mute\" onClick={() =>{\n            setMuted((previousState) => !previousState)\n            if(isLocal)　rtcClient.toggleAudio();\n        }}\n        ref={refVolumeButton}\n        >\n          <Icon className={classes.icon}/>\n        </IconButton>\n    )\n}\n\nexport default VolumeButton;","import {useEffect, useState} from 'react'\n\nconst defaultDimensions = {width: 0, height: 0};\n\nconst useDimensions = (targetRef) => {\n    let [dimensions, setDimensions]=useState({width: 0, height: 0 })\n    const node = targetRef.current;\n\n    const updateDimensions =  (node) => {\n  \n  \n      return node === null \n      ? defaultDimensions\n      : {\n        width: node.offsetWidth,\n        height: node.offsetHeight\n      };\n    };\n     dimensions = updateDimensions(node);\n\n\n     useEffect(() => {\n         const resizeDimensions = () => {\n             setDimensions(updateDimensions(node));\n         };\n         window.removeEventListener('resize', resizeDimensions)\n         window.addEventListener('', resizeDimensions);\n     }, [node]);\n    return dimensions;\n};\n\nexport default useDimensions;","import React, {useRef, useState, } from 'react';\nimport {\n  Card,\n  CardActionArea,\n  CardActions ,\n  CardContent,\n  Typography,\n  } from '@material-ui/core';\n\n  import AudioAnalyser from './AudioAnalyser'\n  import VolumeButton from './VolumeButton'\n  import useDimensions from './hooks/useDimentions';\n\n\nconst Video = ({ isLocal, name, rtcClient, videoRef }) => {\n  const [muted, setMuted] = useState(rtcClient.initialAudioMuted);\n  const refCard = useRef(null);\n  const dimensionsCard = useDimensions(refCard)\n  const refVolumeButton = useRef(null);\n  const dimensionsVolumeButton = useDimensions(refVolumeButton);\n\n  if(videoRef.current)\n  console.log({isLocal, srcObject: videoRef.current.srcObject})\n  return (\n    <Card ref={refCard}>\n      <CardActionArea>\n      <video autoPlay muted={isLocal || muted} ref={videoRef} width={dimensionsCard.width}/>\n\n        <CardContent>\n          <Typography gutterBottom variant=\"h5\" component=\"h2\">\n            {name}\n          </Typography>\n        </CardContent>\n      </CardActionArea>\n      <CardActions>\n        <VolumeButton \n        isLocal={isLocal}\n        muted={muted} \n        refVolumeButton={refVolumeButton}\n        rtcClient={rtcClient}\n        setMuted={setMuted}\n        />\n        {!muted && videoRef.current && videoRef.current.srcObject && (\n        <AudioAnalyser \n        audio={videoRef.current.srcObject} \n        width={dimensionsCard.width - dimensionsVolumeButton.width　-40} \n        />\n        )}\n      </CardActions>\n    </Card>\n  );\n}\n\nexport default Video;","import React, { useEffect, useRef } from 'react';\n\nimport Video from './Video';\n\nconst VideoLocal = ({ rtcClient }) => {\n  const videoRef = useRef(null);\n  const currentVideoRef = videoRef.current;\n  const mediaStream = rtcClient.mediaStream;\n\n  useEffect(() => {\n    if (currentVideoRef === null) return;\n\n    const getMedia = () => {\n      try {\n        currentVideoRef.srcObject = mediaStream;\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    getMedia();\n  }, [currentVideoRef, mediaStream]);\n\nconsole.log({rtcClient})\n\nif(rtcClient.localPeerName === '' || rtcClient.remotePeerName === '')\nreturn<></>\n\n  return (\n    <Video isLocal={true} name={rtcClient.localPeerName} rtcClient={rtcClient} videoRef={videoRef} />\n  );\n};\n\nexport default VideoLocal;","  \nimport React from 'react';\n\nimport Video from './Video';\n\nconst VideoRemote = ({ rtcClient }) => {\n  // TODO: videoRef はrtcClientに持たせる。\n  const videoRef = rtcClient.remoteVideoRef;\n\n  if(rtcClient.remotePeerName === '') return<></>\n\n  return (\n    <Video\n      isLocal={false}\n      name={rtcClient.remotePeerName}\n      rtcClient={rtcClient}\n      videoRef={videoRef}\n    />\n  );\n};\n\nexport default VideoRemote;","\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\n\nimport VideoLocal from './VideoLocal';\nimport VideoRemote from './VideoRemote';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 1,\n  },\n  paper: {\n    padding: theme.spacing(2),\n    textAlign: 'center',\n    color: theme.palette.text.secondary,\n  },\n}));\n\nconst VideoArea = ({ rtcClient }) => {\n  const classes = useStyles();\n\n  if (rtcClient === null) return <></>;\n\n  return (\n    <div className={classes.root}>\n      <Grid container spacing={0}>\n        <Grid item xs={12} sm={6}>\n          <VideoLocal rtcClient={rtcClient} />\n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <VideoRemote rtcClient={rtcClient} />\n        </Grid>\n      </Grid>\n    </div>\n  );\n};\n\nexport default VideoArea;","import firebase from 'firebase/app';\nimport 'firebase/database';\n\nexport default class FirebaseSignallingClient {\n  constructor() {\n\n    const {\n      REACT_APP_FIREBASE_API_KEY,\n      REACT_APP_FIREBASE_AUTH_DOMAIN,\n      REACT_APP_FIREBASE_DATABASE_URL,\n      REACT_APP_FIREBASE_PROJECT_ID,\n      REACT_APP_FIREBASE_STORAGE_BUCKET,\n      REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n      REACT_APP_FIREBASE_APP_ID,\n    } = process.env;\n    \n    const firebaseConfig = {\n      apiKey: REACT_APP_FIREBASE_API_KEY,\n      authDomain: REACT_APP_FIREBASE_AUTH_DOMAIN,\n      databaseURL: REACT_APP_FIREBASE_DATABASE_URL,\n      projectId: REACT_APP_FIREBASE_PROJECT_ID,\n      storageBucket: REACT_APP_FIREBASE_STORAGE_BUCKET,\n      messagingSenderId: REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n      appId: REACT_APP_FIREBASE_APP_ID,\n    };\n\n    if (firebase.apps.length === 0) firebase.initializeApp(firebaseConfig);\n    this.database = firebase.database();\n    this.localPeerName = '';\n    this.remotePeerName = '';\n  }\n\n  setPeerNames(localPeerName, remotePeerName) {\n    this.localPeerName = localPeerName;\n    this.remotePeerName = remotePeerName;\n  }\n\n  get targetRef() {\n    return this.database.ref(this.remotePeerName);\n  }\n\n  async sendOffer(sessionDescription) {\n    await this.targetRef.set({\n      type: 'offer',\n      sender: this.localPeerName,\n      sessionDescription,\n    });\n  }\n\n  async sendAnswer(sessionDescription) {\n    await this.targetRef.set({\n      type: 'answer',\n      sender: this.localPeerName,\n      sessionDescription,\n    });\n  }\n\n  async sendCandidate(candidate) {\n    await this.targetRef.set({\n      type: 'candidate',\n      sender: this.localPeerName,\n      candidate,\n    })\n  }\n\n  async remove(path) {\n    await this.database.ref(path).remove();\n  }\n}","import FirebaseSignallingClient from './FirebaseSignallingClient';\n\nconst INITIAL_AUDIO_ENABLED = false;\n\nexport default class RtcClient {\n  constructor(remoteVideoRef, setRtcClient) {\n    const config = {\n      iceServers: [{ urls: 'stun:stun.stunprotocol.org' }],\n    };\n    this.rtcPeerConnection = new RTCPeerConnection(config);\n    this.firebaseSignallingClient = new FirebaseSignallingClient();\n    this.localPeerName = '';\n    this.remotePeerName = '';\n    this.remoteVideoRef = remoteVideoRef;\n    this._setRtcClient = setRtcClient;\n    this.mediaStream = null;\n  }\n\n  get initialAudioMuted() {\n    return !INITIAL_AUDIO_ENABLED;\n  }\n\n  setRtcClient() {\n    this._setRtcClient(this);\n  }\n\n  async getUserMedia() {\n    try {\n      const constraints = { audio: true, video: true };\n      this.mediaStream = await navigator.mediaDevices.getUserMedia(constraints);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async setMediaStream() {\n    await this.getUserMedia();\n    this.addTracks();\n    this.setRtcClient();\n  }\n\n  addTracks() {\n    this.addAudioTrack();\n    this.addVideoTrack();\n  }\n\n  addAudioTrack() {\n    this.audioTrack.enabled = INITIAL_AUDIO_ENABLED;\n    this.rtcPeerConnection.addTrack(this.audioTrack, this.mediaStream);\n  }\n\n  addVideoTrack() {\n    this.rtcPeerConnection.addTrack(this.videoTrack, this.mediaStream);\n  }\n\n  get audioTrack() {\n    return this.mediaStream.getAudioTracks()[0];\n  }\n\n  get videoTrack() {\n    return this.mediaStream.getVideoTracks()[0];\n  }\n\n  toggleAudio() {\n    this.audioTrack.enabled = !this.audioTrack.enabled;\n    this.setRtcClient();\n  }\n\n  async offer() {\n    const sessionDescription = await this.createOffer();\n    await this.setLocalDescription(sessionDescription);\n    await this.sendOffer();\n  }\n\n  async createOffer() {\n    try {\n      return await this.rtcPeerConnection.createOffer();\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async setLocalDescription(sessionDescription) {\n    try {\n      await this.rtcPeerConnection.setLocalDescription(sessionDescription);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async sendOffer() {\n    this.firebaseSignallingClient.setPeerNames(\n      this.localPeerName,\n      this.remotePeerName\n    );\n\n    await this.firebaseSignallingClient.sendOffer(this.localDescription);\n  }\n\n  setOntrack() {\n    this.rtcPeerConnection.ontrack = (rtcTrackEvent) => {\n      if (rtcTrackEvent.track.kind !== 'video') return;\n\n      const remoteMediaStream = rtcTrackEvent.streams[0];\n      this.remoteVideoRef.current.srcObject = remoteMediaStream;\n      this.setRtcClient();\n    };\n\n    this.setRtcClient();\n  }\n\n  async answer(sender, sessionDescription) {\n    try {\n      this.remotePeerName = sender;\n      this.setOnicecandidateCallback();\n      this.setOntrack();\n      await this.setRemoteDescription(sessionDescription);\n      const answer = await this.rtcPeerConnection.createAnswer();\n      await this.rtcPeerConnection.setLocalDescription(answer);\n      await this.sendAnswer();\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async connect(remotePeerName) {\n    this.remotePeerName = remotePeerName;\n    this.setOnicecandidateCallback();\n    this.setOntrack();\n    await this.offer();\n    this.setRtcClient();\n  }\n\n  async setRemoteDescription(sessionDescription) {\n    await this.rtcPeerConnection.setRemoteDescription(sessionDescription);\n  }\n\n  async sendAnswer() {\n    this.firebaseSignallingClient.setPeerNames(\n      this.localPeerName,\n      this.remotePeerName\n    );\n\n    await this.firebaseSignallingClient.sendAnswer(this.localDescription);\n  }\n\n  async saveReceivedSessionDescription(sessionDescription) {\n    try {\n      await this.setRemoteDescription(sessionDescription);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  get localDescription() {\n    return this.rtcPeerConnection.localDescription.toJSON();\n  }\n\n  async addIceCandidate(candidate) {\n    try {\n      const iceCandidate = new RTCIceCandidate(candidate);\n      await this.rtcPeerConnection.addIceCandidate(iceCandidate);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  setOnicecandidateCallback() {\n    this.rtcPeerConnection.onicecandidate = async ({ candidate }) => {\n      if (candidate) {\n        await this.firebaseSignallingClient.sendCandidate(candidate.toJSON());\n      }\n    };\n  }\n\n  async startListening(localPeerName) {\n    this.localPeerName = localPeerName;\n    this.setRtcClient();\n    await this.firebaseSignallingClient.remove(localPeerName);\n    this.firebaseSignallingClient.database\n      .ref(localPeerName)\n      .on('value', async (snapshot) => {\n        const data = snapshot.val();\n        if (data === null) return;\n\n        const { candidate, sender, sessionDescription, type } = data;\n        switch (type) {\n          case 'offer':\n            await this.answer(sender, sessionDescription);\n            break;\n          case 'answer':\n            await this.saveReceivedSessionDescription(sessionDescription);\n            break;\n          case 'candidate':\n            await this.addIceCandidate(candidate);\n            break;\n          default:\n            this.setRtcClient();\n            break;\n        }\n      });\n  }\n}","  \nimport { useEffect, useReducer, useRef, useState } from 'react';\n\nimport RtcClient from '../../utils/RtcClient';\n\nconst useRtcClient = () => {\n  const [rtcClient, _setRtcClient] = useState(null);\n  const remoteVideoRef = useRef(null);\n  const [, forceRender] = useReducer((boolean) => !boolean, false);\n\n  const setRtcClient = (rtcClient) => {\n    _setRtcClient(rtcClient);\n    forceRender();\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      const client = new RtcClient(remoteVideoRef, setRtcClient);\n      await client.setMediaStream();\n    };\n\n    init();\n  }, []);\n\n  return rtcClient;\n};\n\nexport default useRtcClient;","import React from 'react';\n\nimport InputForms from './InputForms';\nimport VideoArea from './VideoArea';\nimport useRtcClient from './hooks/useRtcClient';\n\nconst App = () => {\n  const rtcClient = useRtcClient();\n\n  return (\n    <>\n      <InputForms rtcClient={rtcClient} />\n      <VideoArea rtcClient={rtcClient} />\n    </>\n  );\n};\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\n\nReactDOM.render(<App />, document.getElementById('root'));"],"sourceRoot":""}